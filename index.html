<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #loader {
            display: none;
            /* Hide by default */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>

    <body class="h-screen flex items-center justify-center" style="background: #edf2f7;">

        <!-- Chatbot Container -->
        <div class="bg-white w-full max-w-4xl h-[80vh] rounded-lg shadow-lg border border-gray-300 flex flex-col">
            <!-- Header Section -->
            <div class="flex flex-col space-y-1.5 p-6 border-b">
                <h2 class="font-semibold text-lg tracking-tight">NeX</h2>
                <p class="text-sm text-gray-500 leading-3">Powered by Mendable and Vercel</p>
            </div>

            <div id="chat-container" class="flex-1 overflow-y-auto p-6 space-y-4">
                <!-- AI Chat Message -->
                <div class="flex gap-3 my-4 text-gray-600 text-sm flex-1">
                    <span class="relative flex shrink-0 overflow-hidden rounded-full w-8 h-8">
                        <div class="rounded-full bg-gray-100 border p-1 w-9">
                            <svg stroke="none" fill="black" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true"
                                height="20" width="20" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z">
                                </path>
                            </svg>
                        </div>
                    </span>
                    <p class="leading-relaxed">
                        <span class="block font-bold text-gray-700">AI</span>
                        Hi, how can I help you today?
                    </p>
                </div>

                <div id="chat-container">
                    <div id="chat-history"></div>
                    <form id="chat-form">
                        <input type="text" id="user-input" placeholder="Enter your message" required>
                        <button type="submit">Send</button>
                    </form>
                </div>
                <div id="loader">
                    <img src="loader.gif" width="150px" alt="Loading...">
                </div>
                <script>
                    const chatHistory = document.getElementById('chat-history');
                    const userInput = document.getElementById('user-input');
                    const form = document.getElementById('chat-form');

                    async function sendMessage() {
                        const userMessage = userInput.value.trim();
                        if (!userMessage) return;

                        userInput.value = ''; // Clear input field
                        chatHistory.innerHTML += `<div class="user-message">${userMessage}</div>`;
                        chatHistory.scrollTop = chatHistory.scrollHeight; // Scroll to the bottom

                        try {
                            const response = await fetch('/chat', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ userInput: userMessage }),
                            });

                            if (!response.ok) {
                                throw new Error('Failed to fetch response from API.');
                            }

                            const data = await response.json();
                            const botMessage = data.response || 'Sorry, I couldn\'t process that.';
                            chatHistory.innerHTML +=

                                `<div class="flex gap-3 my-4 text-gray-600 text-sm flex-1">
                    <span class="relative flex shrink-0 overflow-hidden rounded-full w-8 h-8">
                        <div class="rounded-full bg-gray-100 border p-1 w-9">
                            <svg stroke="none" fill="black" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true"
                                height="20" width="20" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z">
                                </path>
                            </svg>
                        </div>
                    </span>
                    <p class="leading-relaxed">
                        <span class="block font-bold text-gray-700">AI</span>
                        <div class="bot-message">${botMessage}</div>
                    </p>
                </div>`;

                        } catch (error) {
                            console.error('Error:', error);
                            chatHistory.innerHTML += `<div class="bot-message">Oops! Something went wrong. Please try again.</div>`;
                        } finally {
                            chatHistory.scrollTop = chatHistory.scrollHeight; // Scroll to the bottom
                        }
                    }

                    form.addEventListener('submit', (event) => {
                        event.preventDefault(); // Prevent form submission
                        const loader = document.getElementById('loader');
                        loader.style.display = 'block'; // Show loader
                        sendMessage().finally(() => {
                            loader.style.display = 'none'; // Hide loader after the request
                        });
                    });
                </script>
    </body>

</html>